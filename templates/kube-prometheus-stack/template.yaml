repo: https://prometheus-community.github.io/helm-charts
chart: kube-prometheus-stack
chartVersion: 77.12.0
icon: prometheus-logo.svg

latestImages:
  - name: '.crds.upgradeJob.image.busybox | "(.registry)/(.repository)"'
    tag: .crds.upgradeJob.image.busybox.tag

values:
  crds:
    upgradeJob:
      image:
        busybox:
          registry: olcne
          repository: kubectl
        kubectl:
          registry: olcne
          repository: kubectl
  alertmanager:
    alertmanagerSpec:
      image:
        registry: olcne
        repository: alertmanager
  prometheus:
    prometheusSpec:
      image:
        registry: olcne
        repository: prometheus
  prometheusOperator:
    admissionWebhooks:
      deployment:
        image:
          registry: olcne
          repository: prometheus-admission-webhook
          tag: "v0.85.0"
      patch:
        image:
          registry: olcne
          repository: kube-webhook-certgen
          tag: v1.13.1
    image:
      registry: olcne
      repository: prometheus-operator
      tag: "v0.85.0"
    prometheusConfigReloader:
      image:
        registry: olcne
        repository: prometheus-config-reloader
        tag: "v0.85.0"
    thanosImage:
      registry: olcne
      repository: thanos
  thanosRuler:
    thanosRulerSpec:
      image:
        registry: olcne
        repository: thanos

transforms:
  "prometheus/prometheus.yaml":
    prepend: |
      {{- if .Values.prometheus.prometheusSpec.image }}
        {{- $registry := .Values.global.imageRegistry | default .Values.prometheus.prometheusSpec.image.registry -}}
        {{- if and .Values.prometheus.prometheusSpec.image.tag .Values.prometheus.prometheusSpec.image.sha }}
      # extra-image: {{ $registry }}/{{ .Values.prometheus.prometheusSpec.image.repository }}:{{ .Values.prometheus.prometheusSpec.image.tag }}@sha256:{{ .Values.prometheus.prometheusSpec.image.sha }}
        {{- else if .Values.prometheus.prometheusSpec.image.sha }}
      # extra-image: {{ $registry }}/{{ .Values.prometheus.prometheusSpec.image.repository }}@sha256:{{ .Values.prometheus.prometheusSpec.image.sha }}
        {{- else if .Values.prometheus.prometheusSpec.image.tag }}
      # extra-image: {{ $registry }}/{{ .Values.prometheus.prometheusSpec.image.repository }}:{{ .Values.prometheus.prometheusSpec.image.tag }}
        {{- else }}
      # extra-image: {{ $registry }}/{{ .Values.prometheus.prometheusSpec.image.repository }}
        {{- end }}
      {{- end }}

extraChartYqs:
  - '(.dependencies[] | select(.name == "library") | .repository) = "file://./charts/library"'
